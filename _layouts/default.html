<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111111" />

  {% seo %}  <!-- jekyll-seo-tag -->
  {% if site.naver_site_verification %}
  <meta name="naver-site-verification" content="{{ site.naver_site_verification }}">
  {% endif %}

  <link rel="stylesheet" href="{{ '/style.css' | relative_url }}">
</head>
<body>
<a class="skip-link" href="#main">본문 바로가기</a>

<header>
  <h1>
    <a href="{{ '/' | relative_url }}" style="color:#fff; text-decoration:none;">부동산의 모든 것</a>
  </h1>
</header>

<nav>
  <div class="nav-container" role="navigation" aria-label="메인 메뉴">
    <button class="hamburger" id="hamburger" aria-label="메뉴 열기" aria-controls="nav-menu" aria-expanded="false">☰</button>

    <ul class="nav-menu" id="nav-menu">
      <!-- 드롭다운 -->
      <li class="dropdown" id="guide-dropdown" role="none">
        <button
          class="dropdown-toggle"
          id="guide-button"
          type="button"
          aria-haspopup="menu"
          aria-expanded="false"
          aria-controls="guide-submenu"
        >
          가이드 ▼
        </button>

        <!-- hidden으로 열림 제어 -->
        <ul
          class="dropdown-menu"
          id="guide-submenu"
          role="menu"
          aria-labelledby="guide-button"
          hidden
        >
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/1-goal-setting/'         | relative_url }}">1. 목표 설정</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/2-budget-plan/'          | relative_url }}">2. 예산 및 자금 계획</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/3-subscription-check/'   | relative_url }}">3. 청약 여부 확인</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/4-property-research/'    | relative_url }}">4. 매물 조사 및 비교</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/5-purchase-negotiation/' | relative_url }}">5. 계약 진행</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/6-loan-and-closing/'     | relative_url }}">6. 대출 실행 및 잔금 처리</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/7-move-in-prep/'         | relative_url }}">7. 입주 준비</a></li>
          <li role="none"><a role="menuitem" tabindex="-1" href="{{ '/guide/8-tips/'                 | relative_url }}">8. 팁</a></li>
        </ul>
      </li>

      <li role="none"><a role="menuitem" href="{{ '/news/' | relative_url }}">뉴스</a></li>
    </ul>
  </div>
</nav>

<main id="main" role="main" tabindex="-1">
  {{ content }}
</main>

<footer>
  <p>© 2025 부동산의 모든 것. All rights reserved.</p>
</footer>

<script>
  // 요소 핸들
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('nav-menu');

  // 드롭다운 요소
  const dd        = document.getElementById('guide-dropdown');
  const ddBtn     = document.getElementById('guide-button');
  const ddMenu    = document.getElementById('guide-submenu');
  const ddItems   = ddMenu ? Array.from(ddMenu.querySelectorAll('[role="menuitem"]')) : [];

  // 유틸
  const isOpen = () => ddBtn?.getAttribute('aria-expanded') === 'true';
  const openMenu = () => {
    if (!ddBtn || !ddMenu) return;
    ddBtn.setAttribute('aria-expanded', 'true');
    ddMenu.hidden = false;
    // 첫 항목 포커스
    requestAnimationFrame(() => ddItems[0]?.focus());
    document.addEventListener('pointerdown', onOutsidePointer, { capture: true });
    document.addEventListener('keydown', onGlobalKeydown);
  };
  const closeMenu = (focusBtn = true) => {
    if (!ddBtn || !ddMenu) return;
    ddBtn.setAttribute('aria-expanded', 'false');
    ddMenu.hidden = true;
    document.removeEventListener('pointerdown', onOutsidePointer, { capture: true });
    document.removeEventListener('keydown', onGlobalKeydown);
    if (focusBtn) ddBtn.focus();
  };

  // 햄버거 토글
  hamburger?.addEventListener('click', () => {
    const active = navMenu.classList.toggle('active');
    hamburger.setAttribute('aria-expanded', String(active));
    // 네비 열릴 때 드롭다운은 기본 닫힘 유지
    if (!active) closeMenu(false);
  });

  // 드롭다운 버튼: 클릭/키보드로 열기
  ddBtn?.addEventListener('click', () => (isOpen() ? closeMenu() : openMenu()));
  ddBtn?.addEventListener('keydown', (e) => {
    // Enter/Space/ArrowDown으로 열고 첫 항목으로
    if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowDown') {
      e.preventDefault();
      if (!isOpen()) openMenu(); else ddItems[0]?.focus();
    }
    if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (!isOpen()) openMenu(); else ddItems[ddItems.length - 1]?.focus();
    }
  });

  // 메뉴 내 키보드 네비게이션(로빙 탭인덱스)
  ddItems.forEach((item, index) => {
    item.addEventListener('keydown', (e) => {
      const last = ddItems.length - 1;
      switch (e.key) {
        case 'ArrowDown':
          e.preventDefault();
          ddItems[(index + 1) % ddItems.length].focus();
          break;
        case 'ArrowUp':
          e.preventDefault();
          ddItems[(index - 1 + ddItems.length) % ddItems.length].focus();
          break;
        case 'Home':
          e.preventDefault();
          ddItems[0].focus();
          break;
        case 'End':
          e.preventDefault();
          ddItems[last].focus();
          break;
        case 'Tab':
          // 탭으로 메뉴 밖으로 나가면 닫기
          closeMenu(false);
          break;
        case 'Escape':
          e.preventDefault();
          closeMenu(true);
          break;
      }
    });
  });

  // 전역 키다운 (Esc 처리, 열려있을 때만)
  function onGlobalKeydown(e){
    if (e.key === 'Escape' && isOpen()) {
      e.preventDefault();
      closeMenu(true);
    }
  }

  // 바깥 클릭 시 닫기
  function onOutsidePointer(e){
    if (!dd.contains(e.target)) closeMenu(false);
    // 네비 바깥 클릭 시 모바일 메뉴도 닫기
    const withinNav = e.target.closest('.nav-container');
    if (!withinNav && hamburger?.getAttribute('aria-expanded') === 'true') {
      hamburger.setAttribute('aria-expanded', 'false');
      navMenu.classList.remove('active');
    }
  }

  // 포커스가 메뉴/버튼에서 완전히 이탈하면 닫기
  dd?.addEventListener('focusout', (e) => {
    // e.relatedTarget이 드롭다운 내부가 아니면 닫기
    const next = e.relatedTarget;
    if (isOpen() && next && !dd.contains(next)) closeMenu(false);
  });

  // 접근성: 현재 페이지에 aria-current 적용(선택)
  try {
    const currentPath = window.location.pathname.replace(/\/+$/, '');
    document.querySelectorAll('a[role="menuitem"]').forEach(a => {
      const href = a.getAttribute('href');
      if (!href) return;
      const path = new URL(href, window.location.origin).pathname.replace(/\/+$/, '');
      if (path === currentPath) a.setAttribute('aria-current', 'page');
    });
  } catch(_) {}
</script>

{% if page.url contains '/guide/' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "홈",
    "item": "{{ site.url }}{{ site.baseurl }}/"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "{{ page.title | escape }}",
    "item": "{{ site.url }}{{ page.url }}"
  }]
}
</script>
{% endif %}

<!-- 선택: 사용자 선호(감소된 모션) 존중 -->
<style>
  @media (prefers-reduced-motion: reduce) {
    * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
  }
</style>
</body>
</html>
